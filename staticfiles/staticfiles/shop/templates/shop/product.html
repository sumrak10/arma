{% extends 'base.html' %}

{% load static %}
{% block css_link %} 
<link rel="stylesheet" href="{% static 'shop/css/styles.css' %}">
{% endblock %}


{% block content %}
<div class="wrapper">
    <div class="section">
        <div class="shop-nav">
            <a href="/shop/" class="shop-nav-link">
                <svg class="shop-nav-link-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 21">
                    <path d="M15.65 3.299 14.1 1.75 5.35 10.5l8.75 8.75 1.55-1.549L8.447 10.5l7.201-7.201Z"/>
                </svg>
                <div class="shop-nav-link-text">
                    К категориям
                </div>
            </a>
            <a href="/shop/categories/{{ product.category.id }}" class="shop-nav-link">
                <svg class="shop-nav-link-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 21">
                    <path d="M15.65 3.299 14.1 1.75 5.35 10.5l8.75 8.75 1.55-1.549L8.447 10.5l7.201-7.201Z"/>
                </svg>
                <div class="shop-nav-link-text">
                    К товарам
                </div>
            </a>
        </div>
        <div class="product">
            <div class="image">
                <div class="main-image">
                    <img id="main-image" src="{{ product.img.url }}" alt="">
                </div>
                {% if other_images_founded %}
                <div class="other-images">
                    <img id="main-image" src="{{ product.img.url }}" alt="">
                    {% for product_image in product_images %}
                    <img src="{{ product_image.img.url }}" alt="">
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            <div class="details">
                <div class="name">
                    {{ product.name }}
                </div>
                <div class="prices">
                    <div class="price-type">Оптовая цена</div>
                    <div class="price">
                        <div class="number">
                            {{ product.wholesale_price }} р.
                        </div>
                        <div class="text">
                            /шт
                        </div>
                    </div>
                    <div class="price-type">Розничная цена</div>
                    <div class="price">
                        <div class="number">
                            {{ product.retail_price }} р.
                        </div>
                        <div class="text">
                            /шт
                        </div>
                    </div>
                </div>
                <div class="des">
                    {{ product.des }}
                </div>
                <div class="in-basket put_in_basket" product_id="{{ product.id }}">
                    В корзину
                </div>
            </div>
        </div>
        {% if product.video %}
        <div class="yt-video">
            <iframe src="{{ product.video }}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        </div>
        {% endif %}
        <div class="comments">
            {% for comment in comments %}
            <div class="comment">
                <div class="comment-side-img">
                    <img src="{{ comment.img.url }}" alt="">
                </div>
                <div class="comment-side-text">
                    <div class="name">
                        {{ comment.name }}
                    </div>
                    <div class="text">
                        {{ comment.text }}
                    </div>
                    <div class="date">
                        {{ comment.created_at }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="form-section">
            <form class="form" action="{% url 'add_comment' %}" method="post">
                {% csrf_token %}
                <label>Ваше ФИО или название организации</label>
                <input name="name" type="text">
                <input name="product_id" type="hidden" value="{{ product.id }}">
                <label>Расскажите нам о ваших впечатлениях</label>
                <textarea name="text" name="" id="" cols="30" rows="10"></textarea>
                <div class="button-div">
                    <button type="submit">Отправить комментарий</button>
                </div>
                
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        main_img = document.getElementById("main-image")
        imgs_block = document.getElementsByClassName("other-images")[0];
        imgs_block.addEventListener("click", (e) => {
            if (e.target.tagName == "IMG") {
                let main_src = main_img.src;
                main_img.src = event.target.src;
                event.target_src = main_src;
            }
        })
    });
</script>
{% endblock %}